#!/usr/bin/env ruby

require_relative '../config/boot'
require 'pathname'
require 'config'
require 'pp'

require_relative '../lib/rmt'
require_relative '../lib/rmt/mirror'
require_relative '../lib/rmt/rpm'
require_relative '../lib/rmt/downloader'

repository_url = ARGV[0]
local_path = ARGV[1]

unless (repository_url and local_path)
  STDERR.puts "Usage: rmt-mirror [repository_url] [local_path]"
  exit 1
end

Config.load_and_set_settings(
  File.join(File.dirname(__FILE__), '../config/rmt.yml'),
  File.join(File.dirname(__FILE__), '../config/rmt.local.yml')
)

RMT::Mirror.new(
  Settings.mirroring.base_dir,
  repository_url,
  local_path,
  false,
  Logger.new(STDOUT)
).mirror
